<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>상가 매물 관리자 페이지</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Malgun Gothic', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 30px;
        }

        h1 {
            color: #333;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 2px solid #FFE500;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid #e0e0e0;
        }

        .tab {
            padding: 12px 24px;
            background: #f8f8f8;
            border: none;
            border-radius: 8px 8px 0 0;
            cursor: pointer;
            font-size: 1em;
            font-weight: 500;
            color: #666;
            transition: all 0.3s;
        }

        .tab:hover {
            background: #f0f0f0;
        }

        .tab.active {
            background: #FFE500;
            color: #333;
            font-weight: bold;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .form-section {
            margin-bottom: 30px;
        }

        .form-section h2 {
            color: #333;
            font-size: 1.2em;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #e0e0e0;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        label {
            font-weight: 500;
            color: #333;
            margin-bottom: 8px;
            font-size: 0.9em;
        }

        label.required::after {
            content: ' *';
            color: #ff4444;
        }

        input[type="text"],
        input[type="number"],
        input[type="date"],
        select,
        textarea {
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 0.95em;
            transition: all 0.3s;
            font-family: inherit;
        }

        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: #FFE500;
            box-shadow: 0 0 0 3px rgba(255, 229, 0, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .location-group {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            gap: 10px;
            align-items: end;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #FFE500;
            color: #333;
        }

        .btn-primary:hover {
            background: #ffd700;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 229, 0, 0.3);
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #666;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        .btn-danger {
            background: #ff4444;
            color: white;
        }

        .btn-danger:hover {
            background: #cc0000;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 30px;
        }

        .image-upload {
            border: 2px dashed #ddd;
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .image-upload:hover {
            border-color: #FFE500;
            background: #fffef0;
        }

        .image-upload input {
            display: none;
        }

        .image-preview {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .image-preview-item {
            position: relative;
            border-radius: 8px;
            overflow: hidden;
            aspect-ratio: 1;
        }

        .image-preview-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .image-preview-item .remove-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(255, 68, 68, 0.9);
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .property-list {
            display: grid;
            gap: 20px;
        }

        .property-card {
            background: #f8f8f8;
            border-radius: 8px;
            padding: 20px;
            border: 1px solid #e0e0e0;
        }

        .property-card-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 15px;
        }

        .property-card-title {
            font-size: 1.2em;
            font-weight: bold;
            color: #333;
        }

        .property-card-actions {
            display: flex;
            gap: 10px;
        }

        .property-card-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .info-item {
            font-size: 0.9em;
        }

        .info-label {
            color: #666;
            margin-right: 5px;
        }

        .info-value {
            color: #333;
            font-weight: 500;
        }

        .alert {
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .map-container {
            height: 300px;
            border-radius: 8px;
            overflow: hidden;
            margin-top: 10px;
            border: 1px solid #ddd;
        }

        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }

            .location-group {
                grid-template-columns: 1fr;
            }

            .form-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>상가 매물 관리자 페이지</h1>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('register')">매물 등록</button>
            <button class="tab" onclick="switchTab('list')">매물 목록</button>
        </div>

        <!-- 매물 등록 탭 -->
        <div id="register-tab" class="tab-content active">
            <form id="propertyForm" onsubmit="handleSubmit(event)">
                <!-- 기본 정보 -->
                <div class="form-section">
                    <h2>기본 정보</h2>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="required">매물명</label>
                            <input type="text" id="name" name="name" required>
                        </div>
                        <div class="form-group">
                            <label class="required">지역</label>
                            <input type="text" id="region" name="region" placeholder="예: 연산동" required>
                        </div>
                        <div class="form-group">
                            <label class="required">거래형태</label>
                            <select id="transaction_type" name="transaction_type" required onchange="toggleLeaseCondition()">
                                <option value="">선택하세요</option>
                                <option value="매매">매매</option>
                                <option value="임대">임대</option>
                            </select>
                        </div>
                        <div class="form-group" id="leaseConditionGroup" style="display: none;">
                            <label>임대조건</label>
                            <input type="text" id="lease_condition" name="lease_condition" placeholder="예: 보증금 5000만원, 월세 200만원">
                        </div>
                    </div>
                </div>

                <!-- 가격 정보 -->
                <div class="form-section">
                    <h2>가격 정보</h2>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>가격 (억원)</label>
                            <input type="number" id="price_value" name="price_value" step="0.1" min="0" placeholder="예: 12">
                        </div>
                        <div class="form-group">
                            <label>가격 표시</label>
                            <input type="text" id="price" name="price" placeholder="예: 12억원">
                        </div>
                        <div class="form-group">
                            <label>권리금</label>
                            <input type="text" id="key_money" name="key_money" placeholder="예: 문의 또는 5000만원">
                        </div>
                        <div class="form-group">
                            <label>관리비 (원)</label>
                            <input type="number" id="maintenance_fee" name="maintenance_fee" min="0" placeholder="예: 50000">
                        </div>
                    </div>
                </div>

                <!-- 면적 정보 -->
                <div class="form-section">
                    <h2>면적 정보</h2>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>전용면적 (㎡)</label>
                            <input type="number" id="exclusive_area" name="exclusive_area" step="0.1" min="0" placeholder="예: 120">
                        </div>
                        <div class="form-group">
                            <label>공급면적 (㎡)</label>
                            <input type="number" id="supply_area" name="supply_area" step="0.1" min="0" placeholder="예: 150">
                        </div>
                        <div class="form-group">
                            <label>면적 표시</label>
                            <input type="text" id="area" name="area" placeholder="예: 120㎡">
                        </div>
                    </div>
                </div>

                <!-- 위치 정보 -->
                <div class="form-section">
                    <h2>위치 정보</h2>
                    <div class="form-grid">
                        <div class="form-group full-width">
                            <label class="required">주소</label>
                            <div class="location-group">
                                <input type="text" id="address" name="address" required placeholder="부산광역시 연제구 연산동">
                                <button type="button" class="btn btn-secondary" onclick="searchAddress()">주소 검색</button>
                                <button type="button" class="btn btn-secondary" onclick="getCurrentLocation()">현재 위치</button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="required">위도</label>
                            <input type="number" id="lat" name="lat" step="0.000001" required placeholder="예: 35.1820">
                        </div>
                        <div class="form-group">
                            <label class="required">경도</label>
                            <input type="number" id="lng" name="lng" step="0.000001" required placeholder="예: 129.0850">
                        </div>
                        <div class="form-group full-width">
                            <div class="map-container" id="map"></div>
                        </div>
                    </div>
                </div>

                <!-- 상세 정보 -->
                <div class="form-section">
                    <h2>상세 정보</h2>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>주차</label>
                            <input type="text" id="parking" name="parking" placeholder="예: 유, 무, 2대">
                        </div>
                        <div class="form-group">
                            <label>엘리베이터</label>
                            <select id="elevator" name="elevator">
                                <option value="">선택하세요</option>
                                <option value="유">유</option>
                                <option value="무">무</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>방갯수</label>
                            <input type="number" id="room_count" name="room_count" min="0" placeholder="예: 3">
                        </div>
                        <div class="form-group">
                            <label>화장실</label>
                            <input type="number" id="bathroom_count" name="bathroom_count" min="0" placeholder="예: 2">
                        </div>
                        <div class="form-group">
                            <label>용도</label>
                            <input type="text" id="purpose" name="purpose" placeholder="예: 상가, 음식점, 사무실">
                        </div>
                        <div class="form-group">
                            <label>총층수</label>
                            <input type="number" id="total_floors" name="total_floors" min="1" placeholder="예: 3">
                        </div>
                        <div class="form-group">
                            <label>해당층</label>
                            <input type="number" id="floor_number" name="floor_number" min="1" placeholder="예: 2">
                        </div>
                        <div class="form-group">
                            <label>건축물 방향</label>
                            <select id="building_direction" name="building_direction">
                                <option value="">선택하세요</option>
                                <option value="동향">동향</option>
                                <option value="서향">서향</option>
                                <option value="남향">남향</option>
                                <option value="북향">북향</option>
                                <option value="동남향">동남향</option>
                                <option value="동북향">동북향</option>
                                <option value="서남향">서남향</option>
                                <option value="서북향">서북향</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>사용승인일</label>
                            <input type="date" id="approval_date" name="approval_date">
                        </div>
                        <div class="form-group">
                            <label>입주가능일</label>
                            <input type="date" id="move_in_date" name="move_in_date">
                        </div>
                    </div>
                </div>

                <!-- 이미지 업로드 -->
                <div class="form-section">
                    <h2>이미지</h2>
                    <div class="image-upload" onclick="document.getElementById('imageInput').click()">
                        <input type="file" id="imageInput" name="images" multiple accept="image/*" onchange="handleImageSelect(event)">
                        <p>클릭하여 이미지를 선택하세요 (여러 개 선택 가능)</p>
                    </div>
                    <div class="image-preview" id="imagePreview"></div>
                </div>

                <!-- 버튼 -->
                <div class="btn-group">
                    <button type="submit" class="btn btn-primary">매물 등록</button>
                    <button type="button" class="btn btn-secondary" onclick="resetForm()">초기화</button>
                </div>
            </form>
        </div>

        <!-- 매물 목록 탭 -->
        <div id="list-tab" class="tab-content">
            <div id="alertContainer"></div>
            <div class="property-list" id="propertyList">
                <!-- 동적으로 생성됨 -->
            </div>
        </div>
    </div>

    <!-- 카카오맵 API -->
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=3bb53901127a0dc129ccb44d96c97a85&autoload=false"></script>
    
    <script>
        // 전역 변수
        let map;
        let marker;
        let selectedImages = [];
        let editingPropertyId = null;

        // API 엔드포인트 (Cloudflare Worker URL로 변경 필요)
        const API_BASE_URL = '/api'; // 실제 배포 시 Cloudflare Worker URL로 변경

        // 탭 전환
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            if (tabName === 'register') {
                document.querySelector('.tab').classList.add('active');
                document.getElementById('register-tab').classList.add('active');
            } else {
                document.querySelectorAll('.tab')[1].classList.add('active');
                document.getElementById('list-tab').classList.add('active');
                loadPropertyList();
            }
        }

        // 임대조건 필드 표시/숨김
        function toggleLeaseCondition() {
            const transactionType = document.getElementById('transaction_type').value;
            const leaseGroup = document.getElementById('leaseConditionGroup');
            if (transactionType === '임대') {
                leaseGroup.style.display = 'block';
            } else {
                leaseGroup.style.display = 'none';
            }
        }

        // 이미지 선택 처리
        function handleImageSelect(event) {
            const files = event.target.files;
            selectedImages = Array.from(files);
            displayImagePreview();
        }

        // 이미지 미리보기
        function displayImagePreview() {
            const preview = document.getElementById('imagePreview');
            preview.innerHTML = '';

            selectedImages.forEach((file, index) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const div = document.createElement('div');
                    div.className = 'image-preview-item';
                    div.innerHTML = `
                        <img src="${e.target.result}" alt="Preview">
                        <button type="button" class="remove-btn" onclick="removeImage(${index})">×</button>
                    `;
                    preview.appendChild(div);
                };
                reader.readAsDataURL(file);
            });
        }

        // 이미지 제거
        function removeImage(index) {
            selectedImages.splice(index, 1);
            displayImagePreview();
        }

        // 주소 검색 (카카오 주소 API 사용)
        function searchAddress() {
            // 카카오 주소 API는 별도 구현 필요
            alert('주소 검색 기능은 카카오 주소 API를 연동해야 합니다.');
        }

        // 현재 위치 가져오기
        function getCurrentLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        document.getElementById('lat').value = position.coords.latitude;
                        document.getElementById('lng').value = position.coords.longitude;
                        updateMapMarker(position.coords.latitude, position.coords.longitude);
                    },
                    (error) => {
                        alert('위치를 가져올 수 없습니다: ' + error.message);
                    }
                );
            } else {
                alert('이 브라우저는 위치 서비스를 지원하지 않습니다.');
            }
        }

        // 지도 초기화
        function initMap() {
            kakao.maps.load(() => {
                const container = document.getElementById('map');
                const options = {
                    center: new kakao.maps.LatLng(35.1820, 129.0850), // 부산 기본 위치
                    level: 3
                };
                map = new kakao.maps.Map(container, options);

                // 지도 클릭 이벤트
                kakao.maps.event.addListener(map, 'click', (mouseEvent) => {
                    const latlng = mouseEvent.latLng;
                    document.getElementById('lat').value = latlng.getLat();
                    document.getElementById('lng').value = latlng.getLng();
                    updateMapMarker(latlng.getLat(), latlng.getLng());
                });
            });
        }

        // 지도 마커 업데이트
        function updateMapMarker(lat, lng) {
            if (marker) {
                marker.setMap(null);
            }
            const position = new kakao.maps.LatLng(lat, lng);
            marker = new kakao.maps.Marker({ position: position });
            marker.setMap(map);
            map.setCenter(position);
        }

        // 폼 제출
        async function handleSubmit(event) {
            event.preventDefault();

            const formData = new FormData(event.target);
            const propertyData = {
                name: formData.get('name'),
                region: formData.get('region'),
                address: formData.get('address'),
                transaction_type: formData.get('transaction_type'),
                price: formData.get('price'),
                price_value: parseFloat(formData.get('price_value')) || null,
                lease_condition: formData.get('lease_condition') || null,
                exclusive_area: parseFloat(formData.get('exclusive_area')) || null,
                supply_area: parseFloat(formData.get('supply_area')) || null,
                area: formData.get('area'),
                area_value: parseFloat(formData.get('exclusive_area')) || null,
                lat: parseFloat(formData.get('lat')),
                lng: parseFloat(formData.get('lng')),
                key_money: formData.get('key_money') || null,
                maintenance_fee: parseInt(formData.get('maintenance_fee')) || null,
                parking: formData.get('parking') || null,
                elevator: formData.get('elevator') || null,
                room_count: parseInt(formData.get('room_count')) || null,
                bathroom_count: parseInt(formData.get('bathroom_count')) || null,
                purpose: formData.get('purpose') || null,
                total_floors: parseInt(formData.get('total_floors')) || null,
                floor_number: parseInt(formData.get('floor_number')) || null,
                building_direction: formData.get('building_direction') || null,
                approval_date: formData.get('approval_date') || null,
                move_in_date: formData.get('move_in_date') || null,
                type: '상가'
            };

            // 이미지 업로드
            const imageUrls = [];
            if (selectedImages.length > 0) {
                for (const image of selectedImages) {
                    const url = await uploadImage(image);
                    if (url) imageUrls.push(url);
                }
            }
            propertyData.images = imageUrls;

            try {
                let response;
                if (editingPropertyId) {
                    // 수정
                    response = await fetch(`${API_BASE_URL}/properties/${editingPropertyId}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(propertyData)
                    });
                } else {
                    // 등록
                    response = await fetch(`${API_BASE_URL}/properties`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(propertyData)
                    });
                }

                if (response.ok) {
                    showAlert('매물이 성공적으로 등록되었습니다.', 'success');
                    resetForm();
                    switchTab('list');
                } else {
                    const error = await response.json();
                    showAlert('등록 실패: ' + (error.message || '알 수 없는 오류'), 'error');
                }
            } catch (error) {
                showAlert('등록 중 오류가 발생했습니다: ' + error.message, 'error');
            }
        }

        // 이미지 업로드
        async function uploadImage(file) {
            // Cloudflare R2에 업로드하는 로직
            // 실제 구현은 Cloudflare Worker에서 처리
            const formData = new FormData();
            formData.append('image', file);

            try {
                const response = await fetch(`${API_BASE_URL}/upload`, {
                    method: 'POST',
                    body: formData
                });
                const data = await response.json();
                return data.url;
            } catch (error) {
                console.error('이미지 업로드 실패:', error);
                return null;
            }
        }

        // 매물 목록 로드
        async function loadPropertyList() {
            try {
                const response = await fetch(`${API_BASE_URL}/properties`);
                const properties = await response.json();

                const listContainer = document.getElementById('propertyList');
                listContainer.innerHTML = '';

                if (properties.length === 0) {
                    listContainer.innerHTML = '<p>등록된 매물이 없습니다.</p>';
                    return;
                }

                properties.forEach(property => {
                    const card = createPropertyCard(property);
                    listContainer.appendChild(card);
                });
            } catch (error) {
                showAlert('매물 목록을 불러오는 중 오류가 발생했습니다: ' + error.message, 'error');
            }
        }

        // 매물 카드 생성
        function createPropertyCard(property) {
            const card = document.createElement('div');
            card.className = 'property-card';
            
            const images = property.images ? (typeof property.images === 'string' ? JSON.parse(property.images) : property.images) : [];
            const mainImage = images.length > 0 ? images[0] : '';

            card.innerHTML = `
                <div class="property-card-header">
                    <div class="property-card-title">${property.name}</div>
                    <div class="property-card-actions">
                        <button class="btn btn-secondary" onclick="editProperty(${property.id})">수정</button>
                        <button class="btn btn-danger" onclick="deleteProperty(${property.id})">삭제</button>
                    </div>
                </div>
                <div class="property-card-info">
                    <div class="info-item">
                        <span class="info-label">지역:</span>
                        <span class="info-value">${property.region}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">거래형태:</span>
                        <span class="info-value">${property.transaction_type}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">가격:</span>
                        <span class="info-value">${property.price || '-'}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">면적:</span>
                        <span class="info-value">${property.area || '-'}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">주소:</span>
                        <span class="info-value">${property.address}</span>
                    </div>
                </div>
            `;

            return card;
        }

        // 매물 수정
        async function editProperty(id) {
            try {
                const response = await fetch(`${API_BASE_URL}/properties/${id}`);
                const property = await response.json();

                // 폼에 데이터 채우기
                document.getElementById('name').value = property.name || '';
                document.getElementById('region').value = property.region || '';
                document.getElementById('address').value = property.address || '';
                document.getElementById('transaction_type').value = property.transaction_type || '';
                document.getElementById('price').value = property.price || '';
                document.getElementById('price_value').value = property.price_value || '';
                document.getElementById('lease_condition').value = property.lease_condition || '';
                document.getElementById('exclusive_area').value = property.exclusive_area || '';
                document.getElementById('supply_area').value = property.supply_area || '';
                document.getElementById('area').value = property.area || '';
                document.getElementById('lat').value = property.lat || '';
                document.getElementById('lng').value = property.lng || '';
                document.getElementById('key_money').value = property.key_money || '';
                document.getElementById('maintenance_fee').value = property.maintenance_fee || '';
                document.getElementById('parking').value = property.parking || '';
                document.getElementById('elevator').value = property.elevator || '';
                document.getElementById('room_count').value = property.room_count || '';
                document.getElementById('bathroom_count').value = property.bathroom_count || '';
                document.getElementById('purpose').value = property.purpose || '';
                document.getElementById('total_floors').value = property.total_floors || '';
                document.getElementById('floor_number').value = property.floor_number || '';
                document.getElementById('building_direction').value = property.building_direction || '';
                document.getElementById('approval_date').value = property.approval_date || '';
                document.getElementById('move_in_date').value = property.move_in_date || '';

                editingPropertyId = id;
                toggleLeaseCondition();
                updateMapMarker(property.lat, property.lng);
                switchTab('register');
            } catch (error) {
                showAlert('매물 정보를 불러오는 중 오류가 발생했습니다: ' + error.message, 'error');
            }
        }

        // 매물 삭제
        async function deleteProperty(id) {
            if (!confirm('정말 삭제하시겠습니까?')) return;

            try {
                const response = await fetch(`${API_BASE_URL}/properties/${id}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    showAlert('매물이 삭제되었습니다.', 'success');
                    loadPropertyList();
                } else {
                    showAlert('삭제 실패: ' + (await response.json()).message, 'error');
                }
            } catch (error) {
                showAlert('삭제 중 오류가 발생했습니다: ' + error.message, 'error');
            }
        }

        // 폼 초기화
        function resetForm() {
            document.getElementById('propertyForm').reset();
            selectedImages = [];
            document.getElementById('imagePreview').innerHTML = '';
            editingPropertyId = null;
            if (marker) {
                marker.setMap(null);
            }
        }

        // 알림 표시
        function showAlert(message, type) {
            const container = document.getElementById('alertContainer');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;
            container.innerHTML = '';
            container.appendChild(alert);
            setTimeout(() => {
                alert.remove();
            }, 5000);
        }

        // 페이지 로드 시 초기화
        window.onload = () => {
            kakao.maps.load(() => {
                initMap();
            });
        };
    </script>
</body>
</html>

